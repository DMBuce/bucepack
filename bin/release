#!/bin/bash

# parse args
hub_opts=()
for opt in "$@"; do
	hub_opts+=(-a "$opt")
done

# get version of last release
git pull --tags
oldver="$(git describe --tags --abbrev=0)"

# bump version number
version="${oldver%.*}.$(( ${oldver##*.}+1 ))"

# use the commits since last release to populate a changelog
changes="$(git log --oneline $oldver..HEAD | sed 's/[^ ]*/*/')"

# create the draft from a template
export version changes
template release.template - | \
	git hub release create -d "${hub_opts[@]}" -e -F - "$version"

